<?xml version="1.0" encoding="UTF-8"?>
<ModuleDependencies Name="AcfPublic" Version="Main">

	<!--
		There are many Products and many Platforms,
		so BUILD_WIN_QT_PATH have to be defined
		in ...\ExtraBuildSettings\BuildConfigurationSettings
		for example:
			BUILD_WIN_QT_PATH = C:\Qt\5.12.0\msvc2017_64
	-->

	<Targets>
		<Target Default="True" Language="CPP" Name="AcfPublic"/>
		<Target Language="CPP" Name="Acf"/>
		<Target Language="CPP" Name="AcfSln"/>
		<Target Language="CPP" Name="MakeProjects"/>
		<Target Language="CPP" Name="AcfPublic"/>
	</Targets>

	<Dependencies>
		<Dependency>
			<!--Module Name="QtLibraries"/-->
		</Dependency>
		<Dependency IfTarget="AcfSln">
			<Module Name="AcfPublic" Target="Acf"/>
		</Dependency>
		<Dependency IfTarget="AcfPublic">
			<Module Name="AcfPublic" Target="Acf"/>
			<Module Name="AcfPublic" Target="AcfSln"/>
		</Dependency>
	</Dependencies>

	<Builds>
		<!-- generates solution -->
		<Build IfTarget="MakeProjects">
			<QMakeToVisualStudio Project="Acf/Build/QMake/AcfAll.pro"/>
			<QMakeToVisualStudio Project="AcfSln/Build/QMake/AcfSlnAll.pro"/>
		</Build>

		<!-- Build for ACF -->
		<Build IfTarget="Acf">
			<Build IfPlatform="WinOS">
				<QMakeToMakefile Project="Acf/Build/QMake/AcfAll.pro" ShadowBuildFolder="$BUILD_MODULE_TEMP_FOLDER/Acf/Build/QMake/"/>
				<Build>
					<NMake Makefile="Acf/Build/QMake/Makefile" WorkingDirectory="$BUILD_MODULE_TEMP_FOLDER/">
						<EnvironmentVariable Name="QTDIR" Value="$(BUILD_WIN_QT_PATH)" IsReplaceValueWithBuildConfigSettings="True"/>
						<EnvironmentVariable Name="ACFDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/Acf"/>
					</NMake>
				</Build>
			</Build>

			<!-- shadow build for OSX -->
			<Build IfPlatform="MacOS">
				<QMakeToMakefile Project="Acf/Build/QMake/AcfAll.pro" ShadowBuildFolder="$BUILD_MODULE_TEMP_FOLDER/Acf/Build/QMake/">
					<EnvironmentVariable Name="ACFDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/Acf"/>
				</QMakeToMakefile>
				<Make WorkingDirectory="$BUILD_MODULE_TEMP_FOLDER/Acf/Build/QMake/">
					<EnvironmentVariable Name="ACFDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/Acf"/>
				</Make>
			</Build>
		</Build>

		<!-- Build for AcfSln -->
		<Build IfTarget="AcfSln">
			<Build IfPlatform="WinOS">
				<QMakeToMakefile Project="AcfSln/Build/QMake/AcfSlnAll.pro" ShadowBuildFolder="$BUILD_MODULE_TEMP_FOLDER/AcfSln/Build/QMake/"/>
				<Build>
					<NMake Makefile="AcfSln/Build/QMake/Makefile"  WorkingDirectory="$BUILD_MODULE_TEMP_FOLDER/">
						<EnvironmentVariable Name="QTDIR" Value="$(BUILD_WIN_QT_PATH)" IsReplaceValueWithBuildConfigSettings="True"/>
						<EnvironmentVariable Name="ACFDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/Acf"/>
						<EnvironmentVariable Name="ACFSLNDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/AcfSln"/>
					</NMake>/>
				</Build>
			</Build>

			<!-- shadow build for OSX -->
			<Build IfPlatform="MacOS">
				<QMakeToMakefile Project="AcfSln/Build/QMake/AcfSlnAll.pro" ShadowBuildFolder="$BUILD_MODULE_TEMP_FOLDER/AcfSln/Build/QMake/">
					<EnvironmentVariable Name="ACFDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/Acf"/>
					<EnvironmentVariable Name="ACFSLNDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/AcfSln"/>
				</QMakeToMakefile>
				<Make WorkingDirectory="$BUILD_MODULE_TEMP_FOLDER/AcfSln/Build/QMake/">
					<EnvironmentVariable Name="ACFDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/Acf"/>
					<EnvironmentVariable Name="ACFSLNDIR_BUILD" Value="$BUILD_MODULE_TEMP_FOLDER/AcfSln"/>
				</Make>
			</Build>
		</Build>

	</Builds>

</ModuleDependencies>
